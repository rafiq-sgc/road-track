# Visual Guide - How Road Tracker Detects Violations

## ğŸ¬ Video Frame Processing Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  INPUT: Video Frame (1920Ã—1080)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 1: Object Detection (YOLOv8)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ ğŸš— Carâ”‚  â”‚ ğŸï¸ Bikeâ”‚  â”‚ ğŸšŒ Busâ”‚  â”‚ ğŸš¶ Personâ”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚  Confidence: 0.92    0.85      0.78      0.91              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 2: Multi-Object Tracking (ByteTrack)                 â”‚
â”‚  Assigns stable IDs:                                        â”‚
â”‚  ğŸš—#42  ğŸï¸#15  ğŸšŒ#8  ğŸš¶#33                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 3: Violation Detection                               â”‚
â”‚                                                             â”‚
â”‚  For each track:                                           â”‚
â”‚    â”œâ”€ Red Light? (crossing stop line while red)           â”‚
â”‚    â”œâ”€ Lane? (outside lane polygon)                         â”‚
â”‚    â”œâ”€ Speed? (exceeds limit with calibration)             â”‚
â”‚    â””â”€ Wrong-Way? â­ (opposite to lane direction)           â”‚
â”‚                                                             â”‚
â”‚  Track #42: ğŸš— Moving â† (lane direction: â†’)               â”‚
â”‚             Counter: 10 frames â†’ WRONG-WAY!                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 4: Visual Marking & Focus                            â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ [Background Dimmed]                      â”‚              â”‚
â”‚  â”‚                                          â”‚              â”‚
â”‚  â”‚     â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—                   â”‚              â”‚
â”‚  â”‚     â•‘ ğŸš— #42  FOCUS  â•‘ â† Spotlight      â”‚              â”‚
â”‚  â”‚     â•‘   VIOLATED     â•‘ â† Red label      â”‚              â”‚
â”‚  â”‚     â•‘   WRONG WAY    â•‘ â† Violation type â”‚              â”‚
â”‚  â”‚     â•‘       â†‘        â•‘ â† Motion arrow   â”‚              â”‚
â”‚  â”‚     â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                   â”‚              â”‚
â”‚  â”‚                                          â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                             â”‚
â”‚  Effect duration: 5 seconds                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 5: Alert & Evidence                                  â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€ Alert (WebSocket) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ {                                        â”‚              â”‚
â”‚  â”‚   "type": "wrong_way",                   â”‚              â”‚
â”‚  â”‚   "track_id": 42,                        â”‚              â”‚
â”‚  â”‚   "ts": 1698931232.123,                  â”‚              â”‚
â”‚  â”‚   "info": {"lane": 0, "speed": 45.2},   â”‚              â”‚
â”‚  â”‚   "evidence_id": "wrong_way_42_..."     â”‚              â”‚
â”‚  â”‚ }                                        â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€ Evidence Saved â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ violations/                              â”‚              â”‚
â”‚  â”‚   â”œâ”€ crops/wrong_way_42_20231102.jpg    â”‚              â”‚
â”‚  â”‚   â”œâ”€ fullframes/wrong_way_42_20231102.jpgâ”‚             â”‚
â”‚  â”‚   â””â”€ metadata/wrong_way_42_20231102.jsonâ”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§® Wrong-Way Detection Algorithm

### Input
- Track history: `[(t0, x0, y0), (t1, x1, y1), ..., (tn, xn, yn)]`
- Lane direction: `[dx, dy]` (unit vector)

### Computation
```python
# Velocity over window
vx = (xn - x0) / (tn - t0)
vy = (yn - y0) / (tn - t0)
speed = sqrt(vxÂ² + vyÂ²)

# Direction comparison
dot = vx * dx + vy * dy

# Decision
if speed > 30 px/s AND dot < -0.5 * speed:
    wrong_way_counter += 1
    if counter >= 10:
        EMIT VIOLATION!
```

### Visual Example

```
Scenario: Lane direction is â†’

Track A:  â†’ â†’ â†’ â†’ â†’   (dot > 0, counter = 0)  âœ… OK
Track B:  â† â† â† â† â†   (dot < 0, counter +1)  âš ï¸ Building...
         ...10 frames...
Track B:  â† â† â† â† â†   (counter = 10)         ğŸš¨ WRONG-WAY!
```

---

## ğŸ¨ UI Layout Explained

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸš— Road Tracker Pro                        [â—] WebSocket Active â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€ Controls â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Source: [/path/to/video.mp4        ] [â–¶ Start] [â¹ Stop]  â”‚   â”‚
â”‚ â”‚ Signal: [green â–¼] [Apply]    [ğŸ“¥ Export CSV]             â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€ Performance Metrics â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚  â•”â•â•â•â•â•â•â•â•—  â•”â•â•â•â•â•â•â•â•—  â•”â•â•â•â•â•â•â•â•—  â•”â•â•â•â•â•â•â•â•—            â”‚   â”‚
â”‚ â”‚  â•‘ 10.2  â•‘  â•‘ 12.3  â•‘  â•‘  15   â•‘  â•‘  45   â•‘            â”‚   â”‚
â”‚ â”‚  â•‘  FPS  â•‘  â•‘ Detec â•‘  â•‘ Violatâ•‘  â•‘Uptime â•‘            â”‚   â”‚
â”‚ â”‚  â•šâ•â•â•â•â•â•â•â•  â•šâ•â•â•â•â•â•â•â•  â•šâ•â•â•â•â•â•â•â•  â•šâ•â•â•â•â•â•â•â•            â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Live Stream                    â”‚ Alerts (15)                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Filters:                        â”‚
â”‚ â”‚                            â”‚ â”‚ â˜‘Wrong-way â˜‘Red â˜‘Lane â˜‘Speed   â”‚
â”‚ â”‚   [Video with overlays]    â”‚ â”‚                                 â”‚
â”‚ â”‚                            â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚   ğŸŸ¢ Lane boundaries       â”‚ â”‚ â”‚ ğŸ”„ Wrong-way              â”‚   â”‚
â”‚ â”‚   ğŸ”´ Stop line             â”‚ â”‚ â”‚ 10:45:32 AM               â”‚   â”‚
â”‚ â”‚   FPS: 10.2               â”‚ â”‚ â”‚ Track: #42                â”‚   â”‚
â”‚ â”‚                            â”‚ â”‚ â”‚ Lane: 0, Speed: 45px/s    â”‚   â”‚
â”‚ â”‚   Learning: 85%            â”‚ â”‚ â”‚ [View Evidence â†’]         â”‚   â”‚
â”‚ â”‚   (if auto-learning)       â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚ â”‚                            â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ ğŸš¦ Red Light              â”‚   â”‚
â”‚                                â”‚ â”‚ 10:45:28 AM               â”‚   â”‚
â”‚                                â”‚ â”‚ Track: #15                â”‚   â”‚
â”‚                                â”‚ â”‚ Position: (640, 480)      â”‚   â”‚
â”‚                                â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                â”‚ ...more...                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Focus Effect Visualization

### Before Focus (Normal View)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    â”‚
â”‚  ğŸš—  ğŸš—  ğŸš—  ğŸš—  ğŸš—  â†’  (correct)  â”‚
â”‚                                    â”‚
â”‚  ğŸš—  ğŸï¸  ğŸš—  ğŸšŒ  ğŸš—  â†’  (correct)  â”‚
â”‚                                    â”‚
â”‚        ğŸš— â† (WRONG-WAY!)           â”‚
â”‚         â†‘ Track #42                â”‚
â”‚                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### During Focus (5 seconds)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    â”‚
â”‚  [dim]  [dim]  [dim]  [dim]  [dim]â”‚
â”‚         â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘          â”‚
â”‚  [dim]â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— [dim]       â”‚
â”‚       â•‘  ğŸš— #42      â•‘             â”‚
â”‚  [dim]â•‘   FOCUS      â•‘ [dim]       â”‚
â”‚       â•‘   VIOLATED   â•‘             â”‚
â”‚       â•‘   WRONG WAY  â•‘             â”‚
â”‚  [dim]â•‘       â†‘      â•‘ [dim]       â”‚
â”‚       â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•             â”‚
â”‚         â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘          â”‚
â”‚  [dim]  [dim]  [dim]  [dim]  [dim]â”‚
â”‚                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Operators can **clearly identify** the violator even in heavy traffic!

---

## ğŸ“ Evidence Files Example

### After Wrong-Way Violation

**Crop** (`violations/crops/wrong_way_42_20231102_104532_123.jpg`):
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â•”â•â•â•â•â•â•â•—  â”‚
â”‚  â•‘ ğŸš—   â•‘  â”‚  â† Close-up of violator
â”‚  â•‘  â†‘   â•‘  â”‚  â† Shows direction
â”‚  â•šâ•â•â•â•â•â•â•  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Full Frame** (`violations/fullframes/wrong_way_42_20231102_104532_123.jpg`):
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                               â”‚
â”‚  ğŸš— â†’ ğŸš— â†’ ğŸš— â†’ ğŸš— â†’         â”‚  â† Normal traffic
â”‚                               â”‚
â”‚  ğŸš— â†’ ğŸï¸ â†’ ğŸšŒ â†’ ğŸš— â†’         â”‚
â”‚                               â”‚
â”‚        âš ï¸ ğŸš— â† (WRONG-WAY!)  â”‚  â† Marked violator
â”‚                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Metadata** (`violations/metadata/wrong_way_42_20231102_104532_123.json`):
```json
{
  "timestamp": "20231102_104532_123",
  "violation_type": "wrong_way",
  "track_id": 42,
  "bbox": [856, 342, 1024, 445],
  "crop_path": "crops/wrong_way_42_20231102_104532_123.jpg",
  "frame_path": "fullframes/wrong_way_42_20231102_104532_123.jpg",
  "lane": 0,
  "speed_pxps": 45.2
}
```

---

## ğŸ”„ Auto Lane Direction Learning

### Phase 1: Observation (0-6 seconds)

```
Frame 0-180: Collecting samples...

Lane 0:  ğŸš—â†’ ğŸš—â†’ ğŸï¸â†’ ğŸš—â†’ ğŸšŒâ†’ ğŸš—â†’ ğŸš—â†’ ğŸš—â†’
         â†“   â†“   â†“   â†“   â†“   â†“   â†“   â†“
Samples: [â†’] [â†’] [â†’] [â†’] [â†’] [â†’] [â†’] [â†’] ...120 samples

Progress: â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 50%
```

### Phase 2: Learning (6 seconds)

```
Compute median direction:
  Samples: [â†’,â†’,â†’,â†’,â†’,â†’,â†,â†’,â†’,â†’,...] 
           90% â†’, 10% â†
  
  Median: â†’ (robust to outliers)
  
  Lane 0 Direction: [1.0, 0.0] (rightward)

Progress: â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“ 100% âœ“
```

### Phase 3: Detection (6+ seconds)

```
New vehicle appears: ğŸš— moving â†

Velocity: [-45.2, 0.0] px/s (leftward)
Lane Direction: [1.0, 0.0] (rightward)
Dot Product: -45.2 * 1.0 = -45.2 (NEGATIVE!)

Counter: 1 â†’ 2 â†’ 3 â†’ ... â†’ 10 â†’ ALERT! ğŸš¨
```

---

## ğŸ“Š Alert Panel States

### Empty State
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Alerts (0)                  â”‚
â”‚ Filters: â˜‘All               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                             â”‚
â”‚   No violations detected    â”‚
â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Active Alerts
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Alerts (3)                  â”‚
â”‚ Filters: â˜‘Wrong â˜‘Red â˜‘Lane  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ”„ Wrong-way  10:45:32  â”‚ â”‚  â† New (highlighted)
â”‚ â”‚ Track: #42              â”‚ â”‚
â”‚ â”‚ {"lane":0,"speed":45.2} â”‚ â”‚
â”‚ â”‚ [View Evidence â†’]       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸš¦ Red Light  10:45:28  â”‚ â”‚
â”‚ â”‚ Track: #15              â”‚ â”‚
â”‚ â”‚ {"cx":640,"cy":480}     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ âš ï¸ Lane       10:45:15  â”‚ â”‚
â”‚ â”‚ Track: #8               â”‚ â”‚
â”‚ â”‚ {"cx":100,"cy":200}     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ›£ï¸ Lane Configuration Examples

### Single Lane Road

```
View from above:
     â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
     â•‘  â†’  â†’  â†’  â†’  â†’  â†’  â†’ â•‘  Forward traffic
     â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Config:
{
  "lanes": [
    [[0.1, 0.9], [0.1, 0.1], [0.9, 0.1], [0.9, 0.9]]
  ],
  "lane_directions": [
    [[0.5, 0.9], [0.5, 0.1]]  // Bottom â†’ Top
  ]
}
```

### Two-Lane Road (Bidirectional)

```
View from above:
     â•”â•â•â•â•â•â•â•â•â•â•â•â•—â•”â•â•â•â•â•â•â•â•â•â•â•â•—
     â•‘  â†’  â†’  â†’ â•‘â•‘  â†  â†  â† â•‘  
     â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•â•â•â•â•â•
      Lane 0       Lane 1

Config:
{
  "lanes": [
    [[0.0, 0.9], [0.0, 0.1], [0.45, 0.1], [0.45, 0.9]],  // Left lane
    [[0.55, 0.9], [0.55, 0.1], [1.0, 0.1], [1.0, 0.9]]   // Right lane
  ],
  "lane_directions": [
    [[0.25, 0.9], [0.25, 0.1]],  // Left: Bottom â†’ Top
    [[0.75, 0.1], [0.75, 0.9]]   // Right: Top â†’ Bottom
  ]
}
```

**Important**: If car in Lane 0 moves â†, it's wrong-way for that lane!

---

## ğŸ¥ Frame Annotations

### Color Coding

```
Frame with violations:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                 â”‚
  â”‚  ğŸŸ¢ Lane boundary (green)       â”‚
  â”‚  ğŸ”´ Stop line (red)             â”‚
  â”‚                                 â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
  â”‚  â”‚ ğŸš—      â”‚ â† Green box (OK)   â”‚
  â”‚  â”‚ car 0.92â”‚                    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
  â”‚                                 â”‚
  â”‚  â”â”â”â”â”â”â”â”â”â”â”“                    â”‚
  â”‚  â”ƒ ğŸš—      â”ƒ â† Red box (VIOLATED)â”‚
  â”‚  â”ƒ VIOLATEDâ”ƒ                    â”‚
  â”‚  â”ƒ WRONG WAYâ”ƒ                   â”‚
  â”‚  â”—â”â”â”â”â”â”â”â”â”â”›                    â”‚
  â”‚                                 â”‚
  â”‚  FPS: 10.2 â† Performance        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Text Labels

| Label | Color | Meaning |
|-------|-------|---------|
| "VIOLATED" | Red | Track recently violated |
| "FOCUS" | Red | Currently spotlighted |
| "WRONG WAY" | Red | Opposite direction |
| "RED LIGHT" | Red | Stop line violation |
| "LANE VIOLATION" | Orange | Outside lanes |
| "SPEED XX km/h" | Blue | Exceeds limit |
| "NO HELMET" | Red | Missing helmet |
| Plate text | Green | License plate read |
| "FPS: X.X" | Green | Performance indicator |
| "Learning: X%" | Yellow | Auto-learning progress |

---

## ğŸ“ˆ Metrics Dashboard

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Performance Metrics                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   10.2   â”‚ â”‚   12.3   â”‚ â”‚    15    â”‚    â”‚
â”‚  â”‚   FPS    â”‚ â”‚Detection â”‚ â”‚Violationsâ”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚  â”‚    45    â”‚  â† Uptime in minutes          â”‚
â”‚  â”‚  Uptime  â”‚                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Breakdown:
- FPS: Real-time processing speed
- Detection: Avg objects per frame (traffic density)
- Violations: Total count (all types)
- Uptime: Service reliability
```

---

## ğŸ”” Alert Flow (WebSocket vs Polling)

### Old (V1): Polling
```
Browser                    Server
   â”‚                         â”‚
   â”œâ”€â”€â”€ GET /alerts â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
   â”‚â†â”€â”€â”€â”€ Response â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â† 800ms delay
   â”‚                         â”‚
   â”‚... wait 800ms ...       â”‚
   â”‚                         â”‚
   â”œâ”€â”€â”€ GET /alerts â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
   â”‚â†â”€â”€â”€â”€ Response â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
```
**Latency**: 0-800ms

### New (V2): WebSocket
```
Browser                    Server
   â”‚                         â”‚
   â”œâ”€â”€â”€ WS Connect â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
   â”‚â†â”€â”€â”€â”€ Connected â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                         â”‚
   â”‚      [Violation occurs] â”‚
   â”‚                         â”‚
   â”‚â†â”€â”€â”€â”€ Push Alert â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â† Instant!
   â”‚                         â”‚
   â”‚      [Another violation]â”‚
   â”‚                         â”‚
   â”‚â†â”€â”€â”€â”€ Push Alert â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â† Instant!
```
**Latency**: <50ms

---

## ğŸ’¾ Evidence Storage Pattern

### Timeline

```
Time: 10:45:30 - Normal traffic
Time: 10:45:31 - Violation detected!
Time: 10:45:32 - Evidence saved
Time: 10:45:33 - Alert sent
Time: 10:45:34 - Displayed in UI

10:45:32: Evidence files created:
  â”œâ”€â”€ crops/wrong_way_42_20231102_104532_123.jpg
  â”œâ”€â”€ fullframes/wrong_way_42_20231102_104532_123.jpg
  â””â”€â”€ metadata/wrong_way_42_20231102_104532_123.json

10:45:33: Alert pushed via WebSocket:
  {
    "type": "wrong_way",
    "track_id": 42,
    "evidence_id": "wrong_way_42_20231102_104532_123"
  }

10:45:34: User clicks "View Evidence"
  â†’ Opens: /evidence/wrong_way_42_20231102_104532_123
  â†’ Returns metadata JSON
  â†’ UI displays crop image
```

---

## ğŸš€ Performance Tuning Visual

### Processing Time Breakdown

```
Per Frame (100ms total):
â”œâ”€ YOLO Inference:    70ms  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 70%
â”œâ”€ ByteTrack:         15ms  â–ˆâ–ˆâ–ˆâ–ˆ 15%
â”œâ”€ Rule Evaluation:    5ms  â–ˆ 5%
â”œâ”€ Evidence Saving:    3ms  â–ˆ 3%
â”œâ”€ Frame Encoding:     5ms  â–ˆ 5%
â””â”€ Misc:               2ms  â–ˆ 2%

Target: 100ms/frame = 10 FPS âœ“
```

### Optimization Impact

```
Before:
â”œâ”€ YOLO (1080p):      80ms
â”œâ”€ Other:             20ms
â””â”€ Total:            100ms â†’ 10 FPS

After (720p):
â”œâ”€ YOLO (720p):       48ms  â–¼40% reduction
â”œâ”€ Other:             12ms  â–¼40% reduction
â””â”€ Total:             60ms â†’ 16 FPS âœ“
```

---

## ğŸ“ Understanding Coordinates

### Normalized vs Pixel

```
Normalized (0-1):              Pixel (1920Ã—1080):
  0,0 â”€â”€â”€â”€â”€â”€ 1,0                0,0 â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1920,0
   â”‚           â”‚                 â”‚               â”‚
   â”‚  0.5,0.5  â”‚     â”€â”€â”€â”€â”€â”€â†’     â”‚   960,540     â”‚
   â”‚           â”‚                 â”‚               â”‚
  0,1 â”€â”€â”€â”€â”€â”€ 1,1                0,1080 â”€â”€â”€ 1920,1080

Formula:
  x_pixel = x_norm Ã— width
  y_pixel = y_norm Ã— height
```

### Example: Stop Line

```
Normalized: [[0.3, 0.7], [0.7, 0.7]]

On 1920Ã—1080 frame:
  Point 1: (0.3 Ã— 1920, 0.7 Ã— 1080) = (576, 756)
  Point 2: (0.7 Ã— 1920, 0.7 Ã— 1080) = (1344, 756)

Draws a horizontal line at 70% height across middle of frame.
```

---

## âœ… Final Visual Checklist

Before deployment, verify you see:

### On Stream
- [ ] Green lane boundaries drawn
- [ ] Red stop line drawn
- [ ] Object bounding boxes (green when OK, red when violated)
- [ ] Object labels with class and confidence
- [ ] "VIOLATED" label on violators (3s duration)
- [ ] "WRONG WAY" label + arrow on opposite-direction
- [ ] Focus spotlight effect (dimmed background, bright violator)
- [ ] "FOCUS" label on spotlighted track
- [ ] FPS counter (top-right)
- [ ] "Learning: X%" during warmup (if auto-learning)

### In UI
- [ ] WebSocket status (green dot when connected)
- [ ] Metrics dashboard (FPS, detections, violations, uptime)
- [ ] Alerts panel with color-coded badges
- [ ] Filter checkboxes working
- [ ] Timestamps formatted correctly
- [ ] Evidence links clickable
- [ ] Export CSV button functional

### In Filesystem
- [ ] `violations/crops/` has violation crops
- [ ] `violations/fullframes/` has full frames
- [ ] `violations/metadata/` has JSON files
- [ ] Each violation has all 3 files (crop, frame, metadata)

---

**If all checkboxes are âœ“, you're ready for production! ğŸ‰**

See `START_HERE.md` for next steps.

